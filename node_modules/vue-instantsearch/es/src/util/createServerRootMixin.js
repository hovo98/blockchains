import{warn as e}from"./warn.js";import t from"vue";import r from"instantsearch.js/es";function n(e){var r={serverPrefetch:void 0,fetch:void 0,_base:void 0,name:"ais-ssr-root-component",router:e.$router,store:e.$store},n=new(e.$vnode?e.$vnode.componentOptions.Ctor.extend(r):t.component(r.name,Object.assign({},e.$options,r)))({propsData:e.$options.propsData});return n.$slots=e.$slots,n.$root=e.$root,n.$options.serverPrefetch=[],n}function o(t,n){var o,s=r(t);return s.findResultsState=function(e){var t,r,a;try{t=require("vue-server-renderer/basic")}catch(e){}if(!t)throw new Error("you need to install vue-server-renderer");return Promise.resolve().then(function(){r=n(e),(a=r.instantsearch).start(),a.started=!1}).then(function(){return function(e,t){return new Promise(function(r,n){return t(e,function(e,t){e&&n(e),r(t)})})}(r,t)}).then(function(){return e=a.mainHelper,new Promise(function(t,r){e.searchOnlyWithDerivedHelpers(),e.derivedHelpers[0].on("result",function(){t()}),e.derivedHelpers.forEach(function(e){return e.on("error",function(e){r(e)})})});var e}).then(function(){return o={},function e(t,r){return r(t),t.getWidgets().forEach(function(t){"ais.index"===t.$$type&&(r(t),e(t,r))})}(a.mainIndex,function(e){var t=e.getResults(),r=t._state,n=t._rawResults;o[e.getIndexId()]={state:Object.keys(r).reduce(function(e,t){return e[t]=r[t],e},{}),results:n}}),s.hydrate(o),s.getState()})},s.getState=function(){if(!o)throw new Error("You need to wait for findResultsState to finish");return o},s.__forceRender=function(e,t){var r=t.getResults();if(null!==r){var n=r._state,o=t.getHelper();o.state=n,e.render({helper:o,results:r,scopedResults:t.getScopedResults(),parent:t,state:n,templatesConfig:{},createURL:t.createURL,instantSearchInstance:s,searchMetadata:{isSearchStalled:!1}})}},s.hydrate=function(t){t?(s._initialResults=t,s.start(),s.started=!1):e("The result of `findResultsState()` needs to be passed to `hydrate()`.")},s}function s(e){void 0===e&&(e={});var t=e.$cloneComponent;void 0===t&&(t=n);var r=o(e,t);return{provide:function(){return{$_ais_ssrInstantSearchInstance:this.instantsearch}},data:function(){return{instantsearch:r}}}}export{s as createServerRootMixin};
//# sourceMappingURL=createServerRootMixin.js.map
